# Milestone v1.0: API Mapping & Smart Routing

**Status:** âœ… SHIPPED 2026-01-24
**Phases:** 1-4
**Total Plans:** 10

## Overview

This roadmap transforms the existing Kledo MCP server (30+ tools) into a self-documenting, discoverable API layer. The journey progresses from establishing a foundational entity registry, through comprehensive documentation generation, to tool disambiguation, and finally intelligent routing - each phase building on the previous to deliver increasingly powerful AI agent capabilities.

## Phases

### Phase 1: Entity Registry

**Goal:** Establish a complete, machine-readable catalog of all Kledo entities and their relationships using Pydantic models
**Depends on:** Nothing (first phase)
**Plans:** 3 plans in 2 waves

**Success Criteria:**
1. All Kledo entities (Invoice, Contact, Product, Order, Delivery, Account) are defined as Pydantic models with fields and types
2. Relationships between entities are explicitly mapped via Field metadata (e.g., Invoice references Contact, Order contains Products)
3. A visual ERD diagram can be generated from the entity definitions using erdantic
4. Entity definitions are loadable by Python code via `get_all_entities()` and `get_entity_class()`

Plans:
- [x] 01-01-PLAN.md - Core entity models (Contact, Product, Invoice) + package structure
- [x] 01-02-PLAN.md - Transaction entity models (Order, Delivery, Account)
- [x] 01-03-PLAN.md - Entity loader utilities + YAML export + ERD generation

**Key Decisions:**
- Used Decimal type for all currency fields (avoid float precision)
- Embedded types (Warehouse, InvoiceItem) as BaseModel not BaseEntity
- Relationship metadata via json_schema_extra for ERD generation
- ENTITY_REGISTRY for top-level entities, EMBEDDED_TYPES for nested models
- Case-insensitive entity lookup via name.lower()
- ERD generation optional (requires graphviz system binary)

**Completed:** 2026-01-22

---

### Phase 2: Documentation Layer

**Goal:** Generate comprehensive, AI-readable API documentation from entity definitions
**Depends on:** Phase 1 (Entity Registry must exist for documentation to reference)
**Plans:** 3 plans in 2 waves

**Success Criteria:**
1. API endpoint catalog exists mapping each endpoint to its operation and entity
2. Entity relationship documentation is available in Markdown format
3. MkDocs site generates and serves documentation locally
4. llms.txt file exists with AI-optimized tool discovery information
5. Documentation references entity definitions from Phase 1

Plans:
- [x] 02-01-PLAN.md - MkDocs setup + entity documentation with Mermaid ERDs
- [x] 02-02-PLAN.md - Tool extraction script + domain-organized tool documentation
- [x] 02-03-PLAN.md - llms.txt + getting-started guide + GitHub Pages deployment

**Key Decisions:**
- Native Material Mermaid support over mermaid2-plugin (better integration)
- Tool count is 23 not 20 (plan estimated ~20) - all tools documented
- Domain grouping based on business function rather than module name
- Included entity mapping in extract_tools.py for cross-referencing

**Completed:** 2026-01-22

---

### Phase 3: Tool Enhancement

**Goal:** Clarify tool selection by documenting overlaps and creating a disambiguation matrix
**Depends on:** Phase 2 (needs documentation context to explain tool purposes)
**Plans:** 1 plan in 1 wave

**Success Criteria:**
1. Tool disambiguation matrix shows which tool to use for each common use case
2. Tool overlap documentation explains when to use similar tools (e.g., invoice_list vs financial_sales_summary)
3. Each tool's unique purpose is clearly distinguished from related tools

Plans:
- [x] 03-01-PLAN.md - Disambiguation matrix + tool choosing guide

**Completed:** 2026-01-22

---

### Phase 4: Smart Routing

**Goal:** Enable AI agents to find the right tool from natural language business queries
**Depends on:** Phase 1, 2, 3 (uses entities, documentation, and disambiguation for full context)
**Plans:** 3 plans in 2 waves

**Success Criteria:**
1. Synonym dictionary covers common business terms (revenue/sales, vendor/supplier, bill/invoice, customer/client)
2. Tool search capability returns relevant tools for keyword queries
3. Natural language queries resolve to specific tools with suggested parameters
4. Indonesian business terms are supported (faktur, tagihan, piutang, saldo, kas)

Plans:
- [x] 04-01-PLAN.md - Routing foundation (synonyms, date parser, fuzzy matching)
- [x] 04-02-PLAN.md - Pattern library + scoring + main router
- [x] 04-03-PLAN.md - Gap closure: Install rapidfuzz dependency

**Key Decisions:**
- Canonical terms self-map in SYNONYM_MAP for fuzzy discoverability
- 80 score threshold + 3-char minimum for fuzzy matching precision
- Calendar-based vs rolling window distinction for date parsing
- Pattern matching takes precedence over keyword scoring
- Vague queries request clarification instead of guessing
- Tool keywords normalized to canonical forms for matching
- Gap was environment activation issue, not missing dependency

**Completed:** 2026-01-22

---

## Milestone Summary

**Key Decisions:**
- Pydantic models for type-safe entity definitions
- MkDocs Material for documentation (native Mermaid support)
- Bilingual synonym dictionary (Indonesian + English)
- Pattern matching precedence over keyword scoring
- 80% fuzzy match threshold for typo tolerance

**Issues Resolved:**
- Entity relationship visualization through erdantic ERD generation
- Tool disambiguation through comparison matrix
- Natural language query routing through pattern matching + synonyms
- Typo tolerance through RapidFuzz fuzzy matching
- Indonesian business term support through bilingual dictionary

**Issues Deferred:**
- Comprehensive tool parameter documentation (v2.0)
- Structured error responses across all tools (v2.0)
- Additional API coverage (expenses, operation costs) (demand-driven)
- Write operations (create/update) (read-first approach validated)

**Technical Debt Incurred:**
- None significant - architecture is clean and extensible

---

_For current project status, see .planning/PROJECT.md_
